
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Simulador Hemisferio Sur</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background: #050505;
        font-family: 'Segoe UI', sans-serif;
    }

    canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
    }

    .ui {
        position: absolute;
        top: 10px;
        left: 10px;
        pointer-events: none;
        background: rgba(0,0,0,0.8);
        padding: 10px;
        border-radius: 8px;
        border-left: 4px solid #ffeb3b;
        font-size: 12px;
        z-index: 10;
    }

    .instrucciones {
        position: absolute;
        bottom: 20px;
        left: 15px;
        color: #ffeb3b;
        font-weight: bold;
        font-size: 14px;
        background: rgba(0,0,0,0.6);
        padding: 5px;
        z-index: 10;
    }

    /* Bot贸n Volver */
    #volverBtn {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 30;
        background: #ffeb3b;
        color: #000;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s, background 0.2s;
    }
    #volverBtn:hover {
        transform: scale(1.05);
        background: #ffd600;
    }
</style>
</head>
<body>

<canvas id="simulador"></canvas>

<div class="ui">
    <h3 style="margin:0 0 5px 0; color:#ffeb3b; font-size: 14px;">Simulador Sol-Luna</h3>
    <small style="color:#aaa">Arrastra la Tierra o usa el dedo.<br>La luz solar viene desde arriba.</small>
</div>

<div class="instrucciones"> Gira el punto rojo en sentido ANTIHORARIO</div>

<!-- BOTN VOLVER -->
<button id="volverBtn" onclick="window.location.href='index.html';">Volver</button>

<script>
// --- C贸digo del simulador ---
const canvas = document.getElementById('simulador');
const ctx = canvas.getContext('2d');
canvas.width = 1000;
canvas.height = 600;

let timeAngle = -Math.PI / 2; 
let phaseIdx = 0; 
let isDragging = false;

const stars = [];
for (let i = 0; i < 150; i++) {
    stars.push({
        x: Math.random() * (canvas.width * 0.66), 
        y: Math.random() * 420,
        size: Math.random() * 1.5,
        blink: Math.random()
    });
}

const phases = [
    { name: "Nueva", angle: -90, shadow: 0 },
    { name: "Cuarto Menguante", angle: 0, shadow: 1 }, 
    { name: "Llena", angle: 90, shadow: 0 },
    { name: "Cuarto Creciente", angle: 180, shadow: -1 } 
];

// --- Funciones de arrastre ---
function getPos(e) {
    const rect = canvas.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
}
function start(e) {
    const pos = getPos(e);
    if (pos.x < 333 && pos.y > 350) {
        const idx = Math.floor((pos.y - 360) / 55);
        if (idx >= 0 && idx < 4) phaseIdx = idx;
    } else if (pos.x < 333) { isDragging = true; }
}
function move(e) {
    if (isDragging) {
        if (e.cancelable) e.preventDefault();
        const pos = getPos(e);
        timeAngle = Math.atan2(pos.y - 200, pos.x - 166);
    }
}
function end() { isDragging = false; }

canvas.addEventListener('mousedown', start);
window.addEventListener('mousemove', move);
window.addEventListener('mouseup', end);
canvas.addEventListener('touchstart', (e) => { start(e); e.preventDefault(); }, {passive: false});
canvas.addEventListener('touchmove', move, {passive: false});
canvas.addEventListener('touchend', end);

// --- Funci贸n de dibujo de la luna ---
function drawDetailedMoon(ctx, radius, skyAlpha, isMenu = false) {
    ctx.fillStyle = '#e0e0e0';
    ctx.beginPath(); ctx.arc(0, 0, radius, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = 'rgba(0,0,0,0.12)';
    [[-0.3, -0.3, 0.2], [0.4, -0.2, 0.15], [0.1, 0.4, 0.25], [-0.5, 0.2, 0.1]].forEach(c => {
        ctx.beginPath(); ctx.arc(c[0]*radius, c[1]*radius, c[2]*radius, 0, Math.PI*2); ctx.fill();
    });
    ctx.fillStyle = `rgb(${15 + 100 * skyAlpha},${20 + 140 * skyAlpha},${40 + 200 * skyAlpha})`;
    let shadowAmt;
    if (isMenu) {
        ctx.beginPath();
        if (phaseIdx === 0) { ctx.arc(0,0,radius+0.5,0,Math.PI*2);}
        else if (phaseIdx === 2) { }
        else { shadowAmt = (phaseIdx===1)?1:-1; ctx.arc(0,0,radius+0.5,0,Math.PI);}
    } else {
        const phaseToShadow = [1,0,-1,0];
        shadowAmt = phaseToShadow[phaseIdx];
        ctx.arc(0,0,radius+0.5,Math.PI/2,-Math.PI/2);
        ctx.ellipse(0,0,Math.abs(shadowAmt)*radius,radius+0.5,0,-Math.PI/2,Math.PI/2,shadowAmt<0);
    }
    ctx.fill();
}

// --- Funci贸n draw ---
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const w3 = canvas.width/3;

    ctx.fillStyle = '#080810'; ctx.fillRect(0,0,w3,canvas.height);
    ctx.save();
    ctx.translate(w3/2,200);
    ctx.fillStyle='#ffeb3b'; ctx.beginPath(); ctx.arc(0,-170,15,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#1976d2'; ctx.beginPath(); ctx.arc(0,0,40,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='rgba(0,0,0,0.6)'; ctx.beginPath(); ctx.arc(0,0,40,0,Math.PI); ctx.fill();

    const moonSpaceAngle = phases[phaseIdx].angle*(Math.PI/180);
    const mx=Math.cos(moonSpaceAngle)*115;
    const my=Math.sin(moonSpaceAngle)*115;
    ctx.strokeStyle='#333'; ctx.beginPath(); ctx.arc(0,0,115,0,Math.PI*2); ctx.stroke();

    ctx.save();
    ctx.translate(mx,my);
    drawDetailedMoon(ctx,10,0,true);
    ctx.restore();

    ctx.rotate(timeAngle);
    ctx.fillStyle='#f44336'; ctx.beginPath(); ctx.arc(40,0,5,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='white'; ctx.beginPath(); ctx.moveTo(40,0); ctx.lineTo(60,0); ctx.stroke();
    ctx.restore();

    phases.forEach((p,i)=>{
        const by=360+i*55;
        ctx.fillStyle=(phaseIdx===i)?'#2e7d32':'#222';
        ctx.fillRect(15,by,300,45);
        ctx.fillStyle='white'; ctx.font='16px Segoe UI'; ctx.textAlign='center';
        ctx.fillText(p.name,165,by+28);
    });

    ctx.save();
    ctx.translate(w3,0);
    const pw=canvas.width-w3;
    const obsDeg=(timeAngle*180/Math.PI+360)%360;
    let sunSkyPos=(-90-obsDeg+450)%360;
    let skyAlpha=(sunSkyPos>0 && sunSkyPos<180)?Math.sin(sunSkyPos*Math.PI/180):0;
    ctx.fillStyle=`rgb(${15+100*skyAlpha},${20+140*skyAlpha},${40+200*skyAlpha})`;
    ctx.fillRect(0,0,pw,canvas.height);

    if(skyAlpha<0.5){
        ctx.save();
        ctx.globalAlpha=1-(skyAlpha*2);
        stars.forEach(s=>{
            ctx.fillStyle=`rgba(255,255,255,${0.3+Math.abs(Math.sin(Date.now()*0.001+s.blink*10))*0.7})`;
            ctx.beginPath(); ctx.arc(s.x,s.y,s.size,0,Math.PI*2); ctx.fill();
        });
        ctx.restore();
    }

    let sX=(sunSkyPos/180)*pw, sY=420-Math.sin(sunSkyPos*Math.PI/180)*350;
    if(sunSkyPos>0 && sunSkyPos<180){
        ctx.shadowBlur=40; ctx.shadowColor="yellow";
        ctx.fillStyle='#fff9c4'; ctx.beginPath(); ctx.arc(sX,sY,30,0,Math.PI*2); ctx.fill();
        ctx.shadowBlur=0;
    }

    let moonSkyPos=(phases[phaseIdx].angle-obsDeg+450)%360;
    if(moonSkyPos>0 && moonSkyPos<180){
        const mX=(moonSkyPos/180)*pw, mY=420-Math.sin(moonSkyPos*Math.PI/180)*350;
        ctx.save();
        ctx.translate(mX,mY);
        const angleToSun=Math.atan2(sY-mY,sX-mX);
        ctx.rotate(angleToSun);
        drawDetailedMoon(ctx,25,skyAlpha,false);
        ctx.restore();
    }

    ctx.fillStyle='#0a1d0d'; ctx.fillRect(0,420,pw,180);
    ctx.fillStyle="white"; ctx.font="14px Segoe UI"; ctx.textAlign="left"; ctx.fillText("ESTE",20,440);
    ctx.textAlign="right"; ctx.fillText("OESTE",pw-20,440);
    ctx.restore();

    requestAnimationFrame(draw);
}
draw();
</script>

</body>
</html>
